
Регистрация сигналов с магнитных датчиков.

Магнитные датчики подключены к портам 7,8, 35.
Необходимо настроить на вход и подключить подтягивающие резисторы.
Но здесь есть нюанс, возможно настраивать на вход запрещено при работе с прерываниями.
Возможно придется подпаять дополнительные подтягивающие резисторы.

Далее настраиваем прерывания на эти входа.

Прерывания в режиме по начальному и завершающему фронту (CHANGE прерывание вызывается при смене значения на порту, с LOW на HIGH и наоборот).
Фиксируем время (микросекунды) и складываем в буфер.
Одновременно подсчитываем количество импульсов.
В программе прерывания, возможно больше не нужно ничего делать, дабы уменьшить время обработки прерывания.

При временном интервале (значительно большем чем формирование импульсов), понимаем, что импульсы закончились и нужно обрабатывать данные.
Высчитываем длительность каждого импульса и заносим в таблицу.

Формируем график
Ось X время регистрации всех импульсов (общее время хода линейки, перемещения траверсы).
Ось Y длительность импульсов.

При этом максимальная длительность сформированных импульсов (в начале и конце движения) равна минимальным значениям по оси Y 
Минимальная длительность сформированных импульсов (в середине хода линейки) соответствует максимальным значениям по оси Y.

Регистрируем дату и время срабатывания системы.
Регистрируем количество срабатывания защиты.
Подсчитываем моторесурс системы.
Отпределяем что было отключение или подключение штанги.

Записываем данные на SD в удобоваримом виде.
Возможно в нескольких разных файлах типа данные для построения графика, таблицу количества и даты срабатывания системы.
Сравниваем полученный график с образцовым (формируем отдельно с возможностью редактирования, задания параметров).
Храним где нибудь, можно в файле.

При совпадении эталонного графика с зарегистрированым, зеленый свет, при несовпадении желтый.
Процесс срабатывания защиты отмечаем свечением красного светодиода.
Погасить можно при чтении результатов или дистанционно.
Эталонные графики подключения и отключения штанги разные, сравнение в зависимости от движения.

Программируем показ графиков из файлов (при многократном срабатывании , для последующего просмотра).

Выдаем сигнал аварии на АСУ ТП (хз что, не сообщили)
Выдаем сигнал аварии на RS485 (хз что, не сообщили)

После выполнения всех процедур система становиться в исходное состояние, готова регистрировать следующее срабатывание.

Имеем возможность закачать/получить файлы в КОМ порт.